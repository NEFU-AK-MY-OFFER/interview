# 问题

基本概念

* Raft 作用是什么？
* 什么是任期？
* raft kv读写流程
* raft的优势在哪里
* raft中有哪些角色,怎么转换的(领导,候选人,跟随者)
* Raft协议，任期是什么，任期存在哪，日志是什么，日志存在哪，日志下标是什么，存在哪里
* raft 流程
* raft算法要求的最少节点数
* raft 有哪些模块
* raft 解决什么问题

* raft 幽灵复现的问题 + 解决方法

* 一个任期内 follow 给 candidate 投票后然后宕机了，起来后还会再投票吗

* 基于raft 的 kv引擎如何做？

* raft选举leader需要至少几个节点同意
* raft在集群规模3个、4个节点的情况下，分别需要几个节点同意，才能选出leader

* paxos中节点宕机后如何去恢复数据
* 有多个 candidate 发起选举怎么解决？
* raft 和 paxos 选举流程有什么区别？
* 选举超时的设置一般多久，为什么这么设置？
* raft term id 有什么用

* 元数据服务器能做分片吗？怎么做
* 高可用怎么做？
* 分布式kv怎么实现？
* 新 leader 上线怎么继续去日志复制
* raft 这种协议要满足奇数节点吗？面试官觉得是奇数，因为出现 2 2 的网络分区就不可用了，但其实 Quorum 不等于 majority，可以修改协议，实现偶数节点也能正常应对网络分区


* 说一下raft的集群变更

* raft 中大多数节点提交某条日志后，未包含该日志的某个节点能成为 leader 吗？
* raft 论文中 peer 启动的时候是 follower，可以是 candidate 吗？

* 多副本如何选主？
* 多个副本写入如何保证一致性和可靠性？

* 如果用同步复制呢，有什么问题
* Quorum 读写这种方法相比 raft 的问题？
* 如果 Quorum 读写也去设置一个 leader ，然后先写 leader，这种情况会有什么问题
* Raft成员变更
* 为什么raft安全

问了项目的append操作是怎么做的，kv用什么存储
* 然后问了raft的分区容错，脑裂怎么解决的
* 聊聊raft，单点负荷你怎么解决呢
* 介绍一下raft特点，什么是强一致性，一致性有哪些

* 脑裂的读取你怎么办

* raft是如何保证日志一致性的？
* raft中follower发现日志有缺损后如何恢复？

Raft 优化/改造

* Raft 有哪些不足，怎么优化
* raft有什么缺点（答了读请求也要经过follower）
* Prevote机制
* raft 协议选举冲突的优化
* 说一下 raft，有什么方式减少选举次数。
* 怎么优化读请求
* raft leader 接受读写请求，如何优化？
* raft 如何避免惊群效应？raft 惊群怎么优化
* 实现的raft跟工业的raft有什么区别吗（懵了，讲了个prevote机制，刚好看过）
* raft 如何实现从 follower 读取？

* 写操作一定是写 Leader 吗？
* 读操一定从 Leader 吗？
* 能保证读到最新的吗？
* 如何解决，有没有优化方式？
* 主节点一直收不到大部分从节点的心跳回复会怎样。
* 存不存在 Paxos 写虽然写到了大部分，读却没有读到？
* 写只能在 Leader，那性能会不会有瓶颈，怎么解决？
* 怎么保证数据均匀分散到多台机器
* 那怎么让 Leader 尽量均匀分布？
* 怎么确定集群的数量比较合适？
* 怎么测试的性能？
* 解释一下 WAL，必须在事务前落盘吗？
* 如果缓存的日志丢失了怎么办？事务会有问题吗？
* 为什么并发日志性能会好？（是真的疑问）
* 为什么你们可以并发日志？
* 对比 redis 的日志。

Raft 选举

* raft怎么保证只有一个leader
* RAFT如何解决网络分片
* Raft leader 选举过程
* RAFT是否会出现多个leader的情况，如果出现了怎么保证一致性的
* RAFT的消息是怎样的
* 脑裂是什么，什么情况下会出现脑裂（数据分区/Split-brain），项目中对于脑裂的情况是怎么处理的
* 怎么保证网络分区恢复后leader无故下任的情况
* Split-Vote 怎么处理的
* 选举投票的条件
* Raft选举哪些限制
* Raft投票分裂怎么处理
* Raft如何防止脑裂
* 讲一下 raft 的选举机制，为什么要初始化为 follower，为什么要随机超时？
* 讲一下新 leader 上任为什么要 append 一条空 entry？
* Raft 集群发生网络分区会怎么样
* raft选举过程，节点怎么判断落后的，分区问题
* 选举会出现活锁问题吗
* 出现网络分区对 raft 有什么影响？会脑裂吗，描述下场景，怎么解决？
* raft的心跳是什么？raft选举竞争问题怎么解决（心跳时间加上随机值）

Raft 与 CAP

* Raft 实现了 CAP 中的哪两个原则
* Raft 如何高可用
* 采用什么策略保证的强一致性
* 基于raft的kv存储如何实现线性一致性？
* raft协议的线性一致性是推理得出的还是实验证明出来的？（那肯定是推理得到的）你对于线性一致性怎么理解？怎么保证线性一致性？
* 讲一下 raft 为啥能保证一致性
* raft 的可用性
* raft本身能保证线性一致吗？raft本身保证了什么？关于读可以有什么优化，前提是强一致？
* 讲一下raft共识算法，raft实现了什么一致性？客户端总能读到最新的吗？
* raft 容灾
* Raft中如果部分节点落后，如何保证一致性
* get put线性一致性怎么实现的

raft 延时提交的场景分析


客户端

* 客户端网络故障怎么办？如何防止重复请求
* 客户端交互的具体实现


集群配置

* 异步 schema 变更原理
* 异步 schema 变更的实现，真正可用吗？
* 如何处理脑裂，同步配置时出现网络分区怎么处理

如果 Raft 集群超过半数节点挂了会怎么样
multi-Raft 原理（用哈希分片好吗？）

Leader Down 了怎么处理，怎么保障一致性

raft no-op理解


raft在选举时不能正常对外提供服务，这影响大吗？

你怎么看待Raft在拜占庭问题中出现的问题，如果让你改进怎么改进（我说加固leader安全面试官直接否认，又汗流浃背了）
如果单机出现网络分区会出现什么后果，你应该怎样避免这些

Raft协议中出现网络故障导致分区时，如何解决任期号一直增加的问题

raft如何确定一个修改是否能够读了
raft如何commit一个log
如果要进行存储和读取，写请求和读请求需要设计哪些字段
给了个raft的log场景的term，一号节点是1 2，二号节点是1，三号节点是1 3。问这个时候，三号节点挂了，一号节点成为了leader，是否能够把一号节点的log同步到二和三

发生网络故障时raft协议如何工作的

RAFT算法，PBFT算法你是怎么结合的（项目提到的）
如何仿真？
Raft哪些情况下会发生脑裂？怎么解决脑裂？面试官说主要是靠任期，但是我提出疑问，因为分区故障恢复后由于小分区中一直存在选举，所以有的节点任期会很大，会扰乱主分区的正常工作，然后说了解决办法是Raft的prevote机制。

然后拷打MIT6.824的项目，raft底层选举如何实现的，leader和follower方的逻辑分别如何实现。详细介绍下服务端接收到客户端的数据后进行的存储和处理操作流程、日志快照存储和持久化存储的方式、什么时候更新快照以及同步快照，谁来判断是否更新快照以及如何判断。

raft 日志

* 复制日志怎么实现的
* raft的日志需要有什么特点
* 新 leader 上线怎么继续去日志复制
* 日志压缩如何实现的，什么时候做日志压缩
* Raft日志覆盖和回溯的关键点（term ）
* raft怎么进行日志同步
* Raft会存在follower比leader日志多的情况吗，如何解决
* follower收到一个日志，有冲突怎么办
* 如果一个Follower缺了一些日志怎么发现
* leader 和 follower 的日志 有一个index 上的 日志 term 相同，那么之前的日志也是相同的吗？

raft kv数据库是怎么实现的；
raft能保证kv数据库不读到脏数据吗？（不能，有可能没apply到状态机上）
那和mysql那些主从模式有什么区别（我答了主从模式只关注数据一致性，没有关注分布式事务的一致性）。

raft中snapshot怎么实现的，snapshot的作用是什么

raft 中网络延迟/网络分区的情况

工程应用

* etcd如何用raft，etcd底层是如何存储的
* 基于Raft的开源项目或中间件有什么？
* Redis里面使用到了Raft协议，你有了解么？ 啊？？？？
* 为什么zk不用raft？
* 实现paxos算法的工程还有哪个？
* 上层业务如何使用 Raft？（面试官想的是和 etcd 那样单独作为一个存储服务

项目相关6.824 lab
分片怎么迁移
重复请求怎么解决
rpc协议简单介绍一下 继续问rpc流程和序列化
Rpc的Roundbin怎么回事的。
讲讲Rpc的主要工作流程。


如何使用Raft构建一个分布式数据库

假如我用raft实现一个分布式数据库，和我用mysql实现一个分布式数据库，二者有什么区别吗？有什么场景上的区分吗？哪个更好一点？

Raft prevote防止集群被vote 干扰
Raft如何在leader 变化的瞬间也能保持一致性


那如果leader磁盘坏了，又收到另一个follower的OK，但是这个follower还没有成功apply，怎么办？

Leader异常下线会发生什么

一共三个节点Leader挂了描述一下之后发生的事

raft网络分区以后怎么同步日志，以及新老leader节点问题。


弱一致性协议有哪些。（答Paxos，Raft，面试官说不对，这是强一致性协议）

raft通过单机协程模拟和多进程的区别

如何选举leader,判定的条件是什么(term,日志,日志index)

raft和分布式事务的区别
raft、paxos，zab 各解决的什么问题，有什么区别，有什么缺点、性能对比、选举流程区别都讲一下

讲raft和分布式系统，问的挺详细的，raft选主过程，append entries过程，为什么选主要随机选举超时，怎么判断log是最新的，不随机选举超时会有什么问题，raft的term有什么作用，raft现在有什么应用，raft强一致性的应用场景，抛开应用场景强一致性和弱一致性应该怎么选择。

Paxos项目做了什么

Raft能当注册中心吗（当然可以

讲一下paxos（因为聊的很开心，我直接说我就开始吟唱了😼

从CAP--》PACELC

应该再讲NWR的

然后Paxos

活锁

mutil-paxos

你觉得raft和paxos他们有什么本质的区别吗？它为了工程实现丢弃了什么东西？

讲讲raft的子功能过程

-----场景题-----

如果有个节点落后其他节点很多日志，raft怎么处理？

有个读请求到了follower，raft怎么操作

读请求正好打到了刚才那个落后了很多日志的节点上怎么办？

如果实现了线性一致性读，是可以从follower读的

三节点，有一个节点（可能是leader可能是follower宕机），说下此时集群内部是什么情况

宕机节点重新加入集群后发生什么？

网络分区时，候选者的term不停+1后，另外两个节点正常服务，网络恢复后，集群发生什么？

最后说到raft，面试官问raft怎么应对脑裂，我说根据Leader Election和Log Replication，Raft不会有实质的脑裂现象，面试官还举了一些场景，不过我觉得那些场景上述两个机制都覆盖到了，然后就没有然后了

raft分布式集群的项目，
raft算法整体介绍，为什么节点个数是奇数（节约成本），3个结点，其中两个无法通讯会怎样（Leader和可通讯的结点保持连接），如何扩容，增加结点如何数据迁移（没做）。最后推荐看一下商用的zookeeper和redis怎么做的
LSM-tree 存储引擎和 Raft 的关系

出现网络分区，会脑裂吗

raft 这种协议要满足奇数节点吗？面试官觉得是奇数，因为出现 2 2 的网络分区就不可用了，但其实 Quorum 不等于 majority，可以修改协议，实现偶数节点也能正常应对网络分区


项目6.824；

* raft强一致，什么叫强一致；向客户端保证了什么问题；
* 从leader读比较强，从follower读的时候怎么办（讲了zk的FIFO队列和readIndex）
* leader失效了解过吗，怎么保证你读的时候leader还是真正的leader？（说了读之前先发个心跳）
* 这个太浪费资源了，还有其他办法吗，提示一下和任期相关（没想到，后来突然想起了lease机制，但是不太会说，然后面试官可能赶时间，就帮我从头捋了一遍，我就在那“啊对对对我就想说这个”）

分布式一致性怎么保证，mysql的XA和tcc
